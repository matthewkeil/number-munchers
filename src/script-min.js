class Board{constructor(e,t,s){this.extraLives=e,this.level=t,this.gameOver=s,this.rows=t._numRows||5,this.cols=t._numCols||6,this.remainingCorrect=0,this.incrementScoreBy=5,$("main").html(`\n        <div class="board-container">\n            <header>\n                <h1 id="level-name">${t.name}</h1>\n            </header>\n            <div id="board"></div>\n            <footer>\n                <div class="score-container"><span>Score:</span><h3 id="score">0</h3></div>\n                <div id="extra-lives"></div>\n            </footer>\n        </div>`),this.displayExtraLives(),this._board=$("#board");for(let e=0;e<this.rows;e++)this._board.append(this.buildRow(e));this.characters=[],this.muncher=new Muncher(this),this.characters.push(this.muncher)}addTroggle(){this.characters.push(new Troggle(this))}resize(){this.characters.forEach(e=>e.resize())}testCell(e){return this.level.test(e)}randomNumber(){return Math.floor(Math.random()*this.level.maxNumber+1)}buildCell(e,t){const s=this.randomNumber(),r=this.testCell(s);r&&this.remainingCorrect++;const i=document.createElement("div");return i.id=`cell-${e}-${t}`,i.className="cell",i.setAttribute("value",r),i.innerHTML=`<p>${s}</p>`,i}buildRow(e){const t=document.createElement("div");t.className="row",t.id=`row-${e}`;for(let s=0;s<this.cols;s++)t.appendChild(this.buildCell(e,s));return t}incrementScore(){const e=$("#score");e.text(parseInt(e.text())+this.incrementScoreBy),$(".extra-life").addClass("smile"),setTimeout(()=>{$(".extra-life").removeClass("smile")},500)}loseLife(e){$(".extra-life").addClass("frown");const t=$("#row-2"),s=t.html();this.muncher.freeze(),this.muncher.element.hide(),t.html(""),t.append(`<div class="lose-life">\n            <span>Look again!  ${e} is not a ${this.level.name.toLowerCase()}</span>\n        </div>`),setTimeout(()=>{t.html(s),this.muncher.element.show(),this.muncher.unfreeze(),this.extraLives<=0?this.gameOver(null):(this.extraLives--,this.displayExtraLives())},1500)}displayExtraLives(){const e=$("#extra-lives");e.html("");for(let t=0;t<this.extraLives;t++)e.append($(document.createElement("div")).addClass("extra-life"))}}class Character{constructor(e,t){this.name=t,this._frozen=!1,this.moveTime=100,this.board=e,this.element=this.board._board.append(this._element).find("#"+this.name),this.sprite=$(`#${this.name} div`)}get width(){return this.board._board.find(`#cell-${this.row}-${this.column}`).outerWidth()}set width(e){return this.element.css("width",e),e}get height(){return this.board._board.find(`#cell-${this.row}-${this.column}`).outerHeight()}set height(e){return this.element.css("height",e),e}get column(){if(!this.element)return 0;let e=parseFloat(this.element[0].style.left.match(/[-0-9.]*/)[0]);return Math.round(e*this.board.cols/100+1)}set column(e){let t=100*(e-1)/this.board.cols;this.element.animate({left:t+"%"},this.moveTime)}get row(){if(!this.element)return 0;let e=parseFloat(this.element[0].style.top.match(/[-0-9.]*/)[0]);return Math.round(e*this.board.rows/100+1)}set row(e){let t=100*(e-1)/this.board.rows;this.element.animate({top:t+"%"},this.moveTime)}get _element(){let e="<div";return"muncher"===this.name?e+=` id="${this.name}"`:e+=' class="troggle"',e+=` style="\n        width:${this.width}px;\n        height:${this.height}px;\n        top:${this.column}%;\n        left:${this.row}%"\n        >\n            <div></div>\n        </div>`}freeze(){this._frozen=!0}unfreeze(){this._frozen=!1}resize(){this.width=this.width,this.height=this.height}moveLeft(){this.frozen||(this.column--,this.sprite.addClass("walk-left"),setTimeout(()=>{this.sprite.removeClass("walk-left"),Number.isNaN(this.column)&&this.element.remove(0)},100))}moveRight(){this._frozen||(this.column++,this.sprite.addClass("walk-right"),setTimeout(()=>{this.sprite.removeClass("walk-right"),this.column>this.board.cols&&this.element.remove()},100))}moveDown(){this._frozen||(this.row++,this.sprite.addClass("walk-down"),setTimeout(()=>{this.sprite.removeClass("walk-down"),this.row>this.board.rows&&this.element.delete()},200))}moveUp(){this._frozen||(this.row--,this.sprite.addClass("walk-up"),setTimeout(()=>{this.sprite.removeClass("walk-up"),Number.isNaN(this.row)&&this.element.remove()},200))}}class Muncher extends Character{constructor(e){super(e,"muncher")}munchAnimation(){this.sprite.addClass("munch"),setTimeout(()=>this.sprite.removeClass("munch"),80)}munch(){const e=`#cell-${this.row-1}-${this.column-1}`,t=this.board._board.find(e),s=t.attr("value");if(Number.isNaN(parseInt(s))){if("true"===s)return this.munchAnimation(),this.board.incrementScore(),t[0].setAttribute("value",0),t.html(""),this.board.remainingCorrect--,void(this.board.remainingCorrect||this.board.gameOver(this.board.lives));this.board.loseLife($(`${e} h3`).text())}}moveLeft(){if(this.column>1)return super.moveLeft()}moveRight(){if(this.column<this.board.cols)return super.moveRight()}moveDown(){if(this.row<this.board.rows)return super.moveDown()}moveUp(){if(this.row>1)return super.moveUp()}}class Troggle extends Character{constructor(e){super(e,"troggle");const t=["Up","Down","Left","Right"];let s;switch(this.direction=t[Math.floor(Math.random()*t.length)],this.direction){case"Up":s=this.board.cols;case"Down":s=this.board.cols;case"Left":s=this.board.rows;case"Right":s=this.board.rows}}move(){return console.log(this["move"+this.direction])}}let _extraLives=3;const _numRows=5,_numCols=6,levels=[{name:"Multiple of 2",maxNumber:10,test:e=>e%2==0}],randomLevel=()=>levels[Math.floor(Math.random()*levels.length)];function startGame(e,t){function s(){return board.resize.call(board)}function r(e){switch(e.key){case" ":e.preventDefault(),board.muncher.munch();break;case"ArrowUp":e.preventDefault(),board.muncher.moveUp();break;case"ArrowDown":e.preventDefault(),board.muncher.moveDown();break;case"ArrowLeft":e.preventDefault(),board.muncher.moveLeft();break;case"ArrowRight":e.preventDefault(),board.muncher.moveRight()}}function i(){window.removeEventListener("resize",s),window.removeEventListener("keydown",r),t()}0===arguments.length&&(e=_extraLives,t=showStartScreen),board=new Board(e,randomLevel(),function e(t){t?board=new Board(t,randomLevel(),e):i()}),window.addEventListener("resize",s),window.addEventListener("keydown",r),window.onunload=i,window.close=i}function showStartScreen(){$("main").html('<h1 onclick="startGame()">Start</h1>')}startGame(_extraLives,showStartScreen);